<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- T√≠tulo del email din√°mico seg√∫n el ID del pedido -->
    <title>Factura Pedido #<%= order.id %></title>
    <!-- Estilos limpios y responsivos para email -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500;600;700&display=swap');
        body { font-family: 'Montserrat', sans-serif; font-size: 13px; color: #333; margin:0; padding:0; background:#fff; }
        .invoice-container { max-width:950px; margin:0 auto; padding:40px; background:#fff; border-radius:12px; }
        .header { display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #222; padding-bottom:15px; margin-bottom:30px; }
        .logo { font-family:'Playfair Display', serif; font-size:55px; font-weight:700; color:#e91e63; letter-spacing:1px; margin-top: -40px; }
        .header .details { text-align:right; font-size:12px; color:#555; margin-bottom:-10px; }
        h1 { text-align:center; font-family:'Playfair Display', serif; font-size:22px; color:#222; margin:0 0 30px 0; }
        .section { margin-bottom:10px; }
        .section-title, .invoice-info-title { font-weight:700; color:#222; font-family:'Playfair Display', serif; border-bottom:1px solid #f5d0d9; padding-bottom:5px; margin-bottom:15px; text-transform:uppercase; letter-spacing:1px; }
        p { margin:5px 0; }
        .info-grid { display:flex; gap:10px; width:97%; margin-left:auto; }
        .info-grid div:nth-child(1) { width:70%; } 
        .info-grid div:nth-child(2) { width:90%; } 
        .info-grid div:nth-child(3) { width:50%; }
        .product-card { display:flex; background:#fafafa; border-radius:10px; padding:15px 20px; margin-bottom:10px; align-items:center; }
        .product-card img { width:70px; height:70px; object-fit:cover; border-radius:8px; margin-right:20px; flex-shrink:0; }
        .product-info { display:flex; flex-direction:column; flex-grow:1; }
        .product-info p { margin-bottom:3px; font-size:13px; color:#e91e63; }
        .product-info span { margin-bottom:3px; font-size:13px; }
        .product-summary { text-align:right; min-width:120px; font-size:13px; }
        .total { text-align:right; font-size:16px; font-weight:700; color:#e91e63; padding:10px 15px; background:#fdeef2; border-radius:8px; margin-top:10px; }
        .footer { display:flex; flex-direction:column; text-align:center; color:#999; font-size:12px; border-top:3px solid #222; padding-top:10px; margin-top:30px; }
        .footer a { color:#e91e63; text-decoration:none; }
        .invoice-info-title { border: none; margin: 0;}
        .logo-container { display: flex; flex-direction: column; gap: 10px;}
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- ================== HEADER ================== -->
        <div class="header">
            <!-- Informaci√≥n de la empresa -->
            <div class="invoice-info">
                <p class="invoice-info-title"><strong>üè¢ DATOS DE EMPRESA</strong></p>
                <p>ShopBrands S.L. | CIF: B12345678</p>
                <p>Av. del Comercio 45, Madrid, Espa√±a</p>
                <p>Tel: +34 900 123 456</p>
            </div>
            <!-- Logo y detalles de la factura -->
            <div class="logo-container">
                <div class="logo">ShopBrands</div>
                <div class="details">
                    <div>FACTURA: <strong>2025-10/SB<%= order.id %></strong></div>
                    <div>FECHA EMISION: <%= new Date().toLocaleDateString('es-ES') %></div>
                </div>
            </div>
        </div>

        <!-- ================== CLIENTE ================== -->
        <h1>Detalles de la compra</h1>

        <div class="section">
            <div class="section-title">üë§ Informaci√≥n del Cliente</div>
            <div class="info-grid">
                <!-- Contacto del cliente -->
                <div>
                    <p><strong>Contacto:</strong></p>
                    <p><%= order.address.full_name %></p>
                    <p><%= order.address.phone %></p>
                </div>
                <!-- Direcci√≥n de env√≠o -->
                <div>
                    <p><strong>Direcci√≥n de Env√≠o:</strong></p>
                    <p><%= order.address.street %></p>
                    <p><%= [order.address.city, order.address.province].filter(Boolean).join(', ') %></p>
                    <p><%= [order.address.postal_code, order.address.country].filter(Boolean).join(', ') %></p>
                </div>
                <!-- M√©todo y estado de pago -->
                <div>
                    <p><strong>M√©todo de Pago:</strong></p>
                    <p><%= order.payments && order.payments.length>0 ? order.payments[0].method_label : '-' %></p>
                    <p><strong>Estado de Pago:</strong> </p>
                    <p><%= order.payments && order.payments.length>0 ? order.payments[0].status_label : '-' %></p>
                </div>
            </div>
        </div>

        <!-- ================== RESUMEN DEL PEDIDO ================== -->
        <div class="section">
            <div class="section-title">üìã Resumen del Pedido</div>
            <% order.items.forEach(function(item){ %>
            <!-- Item del pedido -->
            <div class="product-card">
                <img src="<%= BASE_URL %>/uploads/<%= item.image_url %>" alt="<%= item.name %>">
                <div class="product-info">
                    <p><strong><%= item.name %></strong></p>
                    <span><strong>Talla:</strong> <%= item.size || '-' %></span>
                    <span><strong>Color:</strong> <%= item.color || '-' %></span>
                    <span><strong>Cantidad:</strong> <%= item.quantity %></span>
                </div>
                <div class="product-summary">
                    <div><%= Number(item.price).toFixed(2) %>‚Ç¨ /u</div>
                    <div><strong>Total: <%= (Number(item.price)*item.quantity).toFixed(2) %>‚Ç¨</strong></div>
                </div>
            </div>
            <% }) %>
        </div>

        <!-- ================== TOTAL ================== -->
        <div class="total">
            <% if(order.discount_amount && order.discount_amount > 0) { %>
                <div style="color:#666; font-size:14px;">Subtotal: <strong style="color:#333;"><%= Number(order.total).toFixed(2) %>‚Ç¨</strong></div>
                <div style="color:#666; font-size:14px;">Descuento cup√≥n: <strong style="color:#0b8043;">-<%= Number(order.discount_amount).toFixed(2) %>‚Ç¨</strong></div>
                <div style="margin-top:10px; font-size:16px; color:#e91e63;"><strong>Total del pedido: <%= Number(order.total_paid).toFixed(2) %>‚Ç¨</strong></div>
            <% } else { %>
                <div style="margin-top:10px; font-size:16px; color:#e91e63;"><strong>Total del pedido: <%= Number(order.total_paid).toFixed(2) %>‚Ç¨</strong></div>
            <% } %>
        </div>

        <!-- ================== FOOTER ================== -->
        <div class="footer">
            <div>
                <p>Gracias por comprar en <strong>ShopBrands</strong>. ¬°Esperamos verte pronto!</p>
                <p><a href="https://www.shopbrands.com">www.shopbrands.com</a> | <a href="mailto:soporte@shopbrands.com">soporte@shopbrands.com</a></p>
            </div>
        </div>
    </div>
</body>
</html>
